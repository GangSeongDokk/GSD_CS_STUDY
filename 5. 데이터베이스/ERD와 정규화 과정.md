# ERD

- ERD(Entity Relationship Diagram)는 데이터베이스를 구축할때 가장 기초적인 뼈대 역할을 하며 릴레이션간의 관계들을 정의한다.

## ERD의 중요성

- ERD는 시스템의 요구 사항을 기반으로 작성되며 ERD를 기반으로 데이터베이스가 구축된다.

- 데이터베이스 구축 이후에도 디버깅 혹은 프로세스 재설계가 필요한 경우에 설계도 역할을 담당한다.

- 관계형 구조로 표현 가능한 데이터를 구성하는데 유용하지만 비정형 데이터를 표현하기 어렵다.

### 비정형 데이터

- 미리 정의된 데이터 모델이 없거나, 있더라도 그렇게 정리되지 않는 비구조화 데이터를 의미한다.

# 정규화 과정

- 정규화 과정은 릴레이션간의 잘못된 종속 관계를 해결하거나, 저장공간을 효율적으로 사용하기 위해 릴레이션을 여러개로 분리하는 과정이다.

- **데이터베이스 이상 현상** : 데이터베이스가 의도대로 동작하지 않는 현상
    + 1개의 등급을 가져야하는데 3개의 등급을 가진다.
    + 삭제할 때, 삭제되면 안되는 데이터까지 삭제된다.
    + 제약조건을 충족시킬 수 없어 데이터가 삽입되지 않는다.

- 정규화 과정은 정규형 원칙을 기반으로 정규형을 만들어가는 과정이며, 정규화된 정도는 정규형(NF, Normal Form)으로 표현한다.
    + 기본 정규형
        * 제1정규형
        * 제2정규형
        * 제3정규형
        * 보이스/코드 정규형
    + 고급 정규형
        * 제4정규형
        * 제5정규형

# [정규화의 특징](https://code-lab1.tistory.com/48)

## 정규화의 장점

- 데이터베이스 이상 현상을 제거할 수 있다.

- 새로운 데이터형의 추가로 인한 확장시 구조 변경이 필요없거나 일부만 변경해도 된다.

- 데이터베이스와 연동된 응용프로그램에 최소한의 영향만을 미치게 되어 응용프로그램의 생명을 연장시킨다.

- 데이터의 중복 속성을 제거하고, 동일한 의미의 일반속성이 하나의 테이블로 집약되므로 한 테이블의 용량이 최소화된다.

## 정규화의 단점

- 릴레이션의 분해로 인해 릴레이션간의 JOIN 연산이 많아진다. 요청에 대한 응답이 느려질 수 있다.

- JOIN 연산이 과도하여 성능이 저하될 경우 반정규화를 하기도 한다.

## 정규형 원칙

- 같은 의미라면 더 좋은 구조로 만든다.

- 자료의 중복성이 낮을 수록 좋다.

- 독립적인 관계는 별개의 릴레이션으로 표현해야한다.

- 각 릴레이션은 독립적인 표현이 가능해야한다.

# 제1정규형

- 릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자 값(atomic value)만으로 구성되어야한다.

- 릴레이션의 속성 값 중에서 한개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어서는 안된다.

- 하나의 칼럼은 하나의 종류나 타입값을 가져야한다.

- 칼럼의 순서가 상관 없어야한다.

- 각 칼럼이 유일한 이름을 가져야한다.

## 정규화 이전

|유저번호|유저ID|수강명|성취도|
|-|-|-|-|
|1|홍철|{C++ 코딩테스트, 프론트 특강}|{90%, 10%}|
|2|범석|{코드포스 특강, DS 특강}|{7%, 8%}|

![제1정규화-1](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/7fe6ee83-1755-4451-94a7-496db7a07b69)

---

## 정규화 이후

|유저번호|유저ID|수강명|성취도|
|-|-|-|-|
|1|홍철|C++ 코딩테스트|90%|
|1|홍철|프론트 특강|10%|
|2|범석|코드포스 특강|7%|
|2|범석|DS 특강|8%|

![제1정규화-2](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/62bff5a0-eeae-4750-8446-4b89672ac307)

# [제2정규형](https://developer111.tistory.com/8)

- 릴레이션이 제1정규형이며 모든 칼럼에 **부분 함수 종속성을 제거**한 형태를 의미한다.

- **부분 함수 종속**이란 기본키가 복합키 일때 그 중 일부 칼럼에만 종속이 일어나는 것이다.

- **완전 함수 종속**이란 기본키의 부분집합이 결정자가 되지 않는다는 것이다.

- **함수 종속** : 데이터베이스의 릴레이션에서 X와 Y가 R의 부분집합이라고 할때, X값 각각에 대해 Y의 값이 오직 하나로 결정될때, Y가 X에 함수 종속적이라고 한다.
    + 이때 X를 결정자, Y를 종속자라고 한다.

## 정규화 이전

![제2정규형-1](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/da366d8a-9c44-470a-9430-a0a4d728ccc9)

- 성적의 특정값을 알기 위해서는 `학생 번호`와 `과목`이 있어야한다.

- 특정 과목의 지도교수는 `과목`만 알고 있으면 알 수 있다.

- 이때 기본키는 `학생 번호`와 `과목`으로 복합키 이지만, 지도교수 칼럼은 `과목`이라는 부분집합에만 종속되는 부분적 종속이다.

## 정규화 이후

![제2정규형-2](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/4339b9c5-1642-4f99-814b-57dc2de91860)

# 제3정규형

- 제2정규형을 만족하면서 기본키를 제외한 모든 속성들 간에 **이행적 함수 종속성(Transitive Functional Dependency)** 이 없는 형태를 의미한다.

- **이행적 함수 종속성** : A -> B 이고, B -> C일때, A -> C가 성립하면 이행적 함수 종속이다.

## 정규화 이전

![제3정규형-1](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/9833b126-87ec-4cf3-adb0-afdf2df465b0)

- `ID`를 알면 `등급`을 알 수 있고, `등급`을 알면 `할인률`을 알 수 있다. 따라서 이행종속성이 존재하여 제3정규형을 만족하지 않는다.

## 정규화 이후

![제3정규형-2](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/0f2cd741-75ed-4561-a926-90e9885b013c)

# BCNF(Boyce-Codd Normal Form, BCNF)

- 제3정규형을 더 강화한 형태이다.

- 제3정규형을 만족하며, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 **모든 결정자가 후보키인 상태**를 의미한다.

- **모든 결정자가 후보키인 상태**란 후보키 집합에 없는 칼럼이 결정자가 되어서는 안된다는 것이다.

## 정규화 이전

![Boyce-Codd 정규형-1](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/f2de44b6-215b-478a-86f0-b45a9d7858fe)

- `학생 번호`와 `과목`을 기본키로 하여 `지도교수`를 알 수 있지만, 동일 `과목`을 다른 `지도교수`가 가르칠 수도 있어서 `과목` -> `지도교수` 종속은 성립하지 않는다.

- 그런데 `지도교수`를 알 경우 가르치는 `과목`을 알 수 있으므로, `지도교수` -> `과목` 종속은 성립한다.

- 이렇게 후보키 집합이 아닌 칼럼이 결정자가 되는 상황은 BCNF를 만족하지 않는다.

## 정규화 이후

![Boyce-Codd 정규형-2](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/e83f810f-3b7e-4bf8-be6b-79d78fd16c29)

# [제4정규화 이상](https://code-lab1.tistory.com/270)

- 보통 정규화는 BCNF까지만 수행하는 경우가 많다.

- 그 이상의 정규화는 정규화의 단점이 나타나기 쉽다.

# 제4정규화

- BCNF를 만족하며, **다치 종속(Multi-valued Dependency)** 가 없어야한다.

- **다치 종속**이란 다음의 경우를 말한다.
    + A -> B일때 하나의 A값에 여러개의 B값이 존재하면 다치 종속성을 가진다고 표현하고 A ->> B라고 한다.
    + 최소 3개의 칼럼이 존재한다.
    + R(A,B,C)가 존재하고 A와 B사이에 다치 종속성이 있을 때, B와 C가 독립적이다.


## 정규화 이전

![제4정규형-1](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/b7c02d79-8e49-4a1a-9fd4-c7d184729ce1)

- `학생 번호` 하나에 `과목` 여러개와 `취미` 여러개가 종속되어 있다.

- `학생 번호`를 기준으로 조회하면 다음과 같은 중복이 발생한다.

![제4정규형-2](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/d18e9a04-de74-4d28-989c-1eeb45697932)

## 정규화 이후

![제4정규형-3](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/19737110-128a-4866-9523-d9e1f77db88a)

- 두 테이블은 여전히 다치 종속성을 가지지만, 2개 이상의 칼럼이 하나의 칼럼에 다치 종속되지는 않으므로 제4정규형을 만족한다.

# 제5정규화

- 중복을 제거하기 위해 분해할 수 있는만큼 전부 분해하는 것이다.

- Project Join Normal Form이라고도 불린다.

- 제4정규형을 만족하고, **조인 종속(Join Dependency)** 가 없어야한다.

- **조인 종속**이란 다음의 특성을 의미한다.
    + 다치 종속의 좀더 일반화된 형태이다.
    + 하나의 릴레이션을 여러개의 릴레이션으로 무손실 분해했다가 다시 결합할 수 있으면 조인 종속이라고 한다.
    + A 릴레이션을 B,C 릴레이션으로 분해했다가 다시 조인했을때 그대로 A가 된다면, A는 조인 종속성이 있다고 한다.

    ![제5정규형](https://github.com/GangSeongDokk/GSD_CS_STUDY/assets/109258608/be5e7d15-f5a0-475d-ad20-bca47b89e927)

- 조인 연산을 했을때 손실이 없어야한다.

- 일반적으로 현실의 데이터베이스에서는 제5정규형을 사용하지 않는다.

# [테이블과 릴레이션의 차이](https://5dol.tistory.com/17)

- 릴레이션은 모두 테이블이지만, 모든 테이블이 릴레이션인 것은 아니다.

- 릴레이션의 특징은 아래와 같다.
    + 행은 개체에 대한 데이터를 포함한다.
    + 열은 개체의 속성에 대한 데이터를 포함한다.
    + 한 열의 모든 항목은 동일한 종류이다.
    + 각 열은 유일한 이름을 가진다.
    + 테이블의 셀은 단일한 값만을 가진다.(제1정규화)
    + 행과 열의 순서는 중요하지 않다.
    + 어떤 두 행도 서로 동일하지 않다.