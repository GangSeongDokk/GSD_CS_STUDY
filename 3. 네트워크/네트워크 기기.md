# 2.3 네트워크 기기

## 2.3.1 네트워크 기기의 처리 범위

![image](https://blog.kakaocdn.net/dn/FoyBq/btqLFSoBzXq/9cm2LtSxkE1VtMLJHsuO0k/img.png)

- OSI 7계층을 기준으로 처리 범위를 나눔
- 상위 계층을 처리하는 기기는 하위 계층도 처리가 가능하지만, 반대는 불가능

## 2.3.2 애플리케이션 계층을 처리하는 기기

### L7 스위치

- 서버의 부하를 분산시키는 `로드밸런서`의 역할. 클라이언트로부터 오는 요청들을 여러 서버로 나누어줌
- URL, 서버, 캐시, 쿠키들을 기반으로 트래픽을 분석하여 바이러스나 불필요한 데이터를 필터링

### 로드 밸런싱?

![image](https://blog.kakaocdn.net/dn/bx0V6M/btrpMjf4yLq/ZDDhPdTMsYaGkF3s95wAK1/img.png)

- 컴퓨터 네트워크 기술의 일종으로, 둘 이상의 CPU, 저장장치같은 컴퓨터 자원들에게 작업(work), 즉 부하(load)를 나누는 것을 의미
- 하드웨어의 성능을 올리거나(Scale-up) 여러대의 서버가 나눠서 일하도록 만드는(Scale-out) 방법이 있음

> ### 로드 밸런싱의 기본 기능
>
> 1. Health Check(상태 확인)
>
> - 서버들에 대한 주기적인 Health Check를 통해 `서버들의 장애 여부를 판단, 정상 동작중인 서버로만 트래픽을 보냄`
> - L3 체크 : `ICMP프로토콜`을 이용하여 서버의 IP 주소가 통신 가능한 상태인지 확인
> - L4 체크 : TCP의 특성을 바탕(`3-way handshake`)으로 각 포트의 상태를 체크
> - L7 체크 : `실제 웹 페이지에 통신`을 시도하여 이상 유무를 파악
>
> 2. 터널링
>
> - 데이터 스트림을 인터넷 상에서 `가상의 파이프를 통해 전달`시키는 기술
> - `연결된 상호 간에만 캡슐화된 패킷을 구별하고 해제가 가능`하게 함
>
> 3. NAT(Network Address Translation)
>
> - 내부 네트워크에서 사용하는 `사설 IP주소와 공인 IP주소를 변환`
> - SNAT(Source Network Address Translation) : 내부 사설 IP -> 외부 공인 IP 변환
> - DNAT(Destination Network Address Translation) : 외부 공인 IP -> 내부 사설 IP 변환
>
> 4. DSR(Destination Network Address Translation)
>
> - 서버에서 클라이언트로 트래픽이 되돌아가는 경우, 목적지를 클라이언트로 설정하여 `네트워크 장비를 거치치 않고 바로 클라이언트를 찾아가게 함`
> - 로드밸런서의 부하 감소효과

> ### 로드 밸런싱 알고리즘
>
> - 라운드 로빈 방식
>
>   - 서버로 들어온 `요청을 순서대로 돌아가면서 배정`
>   - 클라이언트의 오청을 순서대로 분배하기 때문에 `서버들이 동일한 스펙을 갖고 있고`, `서버와의 연결(세션)이 오래 지속되지 않는 경우` 적합
>
> - 가중 라운드로빈 방식
>
>   - 각 서버마다 `가중치`를 메기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분
>   - 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 방식
>
> - IP 해시 방식
>
>   - `클라이언트의 IP 주소를 특정 서버로 매핑`하여 요청을 처리
>   - 사용자의 IP를 `해싱(임의의 길이를 지닌 데이터를 고정되 길이의 데이터로 매핑)`하여 부하를 분산하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장
>   - 경로가 보장되며 접속자 수가 많을 수록 분산 효율이 뛰어남
>
> - 최소 연결 방식
>
>   - 요청이 들어온 시점에서 가장 `적은 연결(세션) 상태를 보이는 서버`에 우선적으로 트래픽을 할당
>
> - 최소 응답시간 방식
>
>   - 서버의 현재 연결 상태와 응답 시간을 모두 고려하여 `가장 짧은 응답시간을 보내는 서버로 트래픽을 할당`
>
> - 대역폭 방식
>   - 서버들과의 대역폭을 고려하여 서버에 트래픽을 할당

> ### L4 스위치 vs L7 스위치
>
> - L4 스위치
>
>   - 네트워크 계층(IP, 포트)이나 전송 계층(TCP, UDP)의 정보를 바탕으로 트래픽을 분산
>   - IP 주소, 포트 번호, MAC 주소, 전송 프로토콜에 따라 트래픽 분산이 가능
>   - CLB(Connection Load Balancer)또는 SLB(Session Load Balancer)라고도 함
>
> - L7 스위치
>   - L4 스위치의 범위를 포함하여 애플리케이션 계층(HTTP, FTP, STMP)에서 트래픽 분산이 가능

## 2.3.3 네트워크 계층을 처리하는 기기

- 라우터, L3 스위치, 게이트웨이 등

### 라우터

- 여러 개의 네트워크를 연결, 분할, 구분시켜주는 역할
- IP 패킷을 참조
- 패킷의 위치를 추출하고, 그 위치에 대한 `최적의 경로`를 지정

### 게이트 웨이

- 실제로는 모든 계층에서 동작하는 장비
- 서로 다른 네트워크로 이동하기 위한 `관문`
- 프로토콜이 다른 기기 끼리도 통신할 수 있도록 프로토콜을 적절히 변환해주는 역할

### L3 스위치

- 라우터라고 해도 무방

## 2.3.4 데이터 링크 계층을 처리하는 기기

- L2 스위치, 브리지

### L2 스위치

- 사실상 "스위치"는 보통 L2 스위치를 가리킴
- 장치들의 MAC 주소와 포트 번호가 기록된 MAC주소 테이블을 가지고 있어, 목적지 MAC 주소를 가진 장비가 연결된 포트로만 프레임을 전송

### 브리지

- 두 개의 근거리 통신망(LAN)을 서로 연결해주는 장치

## 2.3.5 물리 계층을 처리하는 기기

- NIC, 리피터, AP

### NIC(Network Interface Card)

- 컴퓨터를 LAN에 연결시키는 장비로, 랜카드라고도 함
- MAC주소가 존재

### 리피터

- 신호를 수신하여 증폭하고, 다음 구간으로 전달하는 장치
- 패킷을 더 멀리 보내기 위해 사용
- 광 케이블의 보급화로 현재에는 잘 쓰이지 않음

### 허브

- 전기 신호를 증폭 시켜 LAN의 전송 거리 연장 및 여러대의 장비를 LAN에 접속할 수 있게 해줌
- 더미 허브
  - 전기적 신호를 복제해서 활성화된 포트에 흘려주는 역할
- 스위칭 허브
  - 현재 대부분이 스위칭허브로 구성되어있음
  - MAC Adress 학습 기능을 이용하여 경로를 찾아 포워딩 해줌(2계층 장비로 분류됨)
